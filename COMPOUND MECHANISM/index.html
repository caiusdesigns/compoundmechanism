<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Supplement Library</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; margin: 24px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 12px; cursor: pointer; }
    .card:hover { border-color: #999; }
    .name { font-weight: 650; margin: 0 0 6px; }
    .cat { font-size: 12px; opacity: 0.7; margin: 0; }
    dialog { width: min(720px, 92vw); border: none; border-radius: 14px; padding: 16px; }
    dialog::backdrop { background: rgba(0,0,0,.35); }
    .mech { line-height: 1.45; }
    .top { display:flex; justify-content:space-between; gap:12px; align-items:flex-start; }
    button { cursor:pointer; }
  </style>
</head>
<body>
  <h1>Supplement Library</h1>
  <div id="grid" class="grid"></div>

  <dialog id="modal">
    <div class="top">
      <div>
        <div id="mName" class="name"></div>
        <div id="mCat" class="cat"></div>
      </div>
      <button id="closeBtn">Close</button>
    </div>
    <hr />
    <div id="mMech" class="mech"></div>
  </dialog>

  <script>
    const grid = document.getElementById("grid");
    const modal = document.getElementById("modal");
    const closeBtn = document.getElementById("closeBtn");
    const mName = document.getElementById("mName");
    const mCat = document.getElementById("mCat");
    const mMech = document.getElementById("mMech");

    closeBtn.onclick = () => modal.close();

    async function main() {
      const res = await fetch("./library.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to load library.json: " + res.status);
      const items = await res.json();

      // Optional: sort by category then name
      items.sort((a,b) =>
        (a.category || "").localeCompare(b.category || "") ||
        (a.name || "").localeCompare(b.name || "")
      );

      for (const item of items) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <p class="name">${escapeHtml(item.name)}</p>
          <p class="cat">${escapeHtml(item.category)}</p>
        `;
        card.onclick = () => {
          mName.textContent = item.name || "";
          mCat.textContent = item.category || "";
          mMech.textContent = item.mechanism || "";
          modal.showModal();
        };
        grid.appendChild(card);
      }
    }

    function escapeHtml(s="") {
      return String(s).replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    main().catch(err => {
      document.body.insertAdjacentHTML("beforeend", `<pre>${err}</pre>`);
      console.error(err);
    });
  </script>
</body>
</html>